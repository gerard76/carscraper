<%= render 'search_form' %>

<div id="chart" style="width: 800px; height: 500px;"></div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const chartDom = document.getElementById('chart');
  const myChart = echarts.init(chartDom, 'dark');

  const data = <%= raw @data.to_json %>;

  const option = {
    title: { text: 'Car Prices by Year' },
    tooltip: {
      trigger: 'item',
      formatter: function(params) {
        return `
          ${params.data.type}<br>
          Year: ${params.data.value[0]}<br>
          Price: ${params.data.value[1]}<br>
          KM: ${params.data.km}<br>
          ${params.data.version}
        `;
      }
    },
    xAxis: {
      name: 'Year',
      type: 'category',
      data: [...new Set(data.map(d => d.value[0]))].sort((a, b) => a - b)
    },
    yAxis: {
      name: 'Price',
      type: 'value',
      min: <%= @cars.minimum(:price) -1000 %>
    },
    series: [{
      type: 'scatter',
      data: data,
      symbolSize: 10
    }]
  };

  myChart.setOption(option);

  // Make dots clickable
  myChart.on('click', function(params) {
    if (params.data.url) {
      window.location.href = params.data.url;
    }
  });
});
</script>